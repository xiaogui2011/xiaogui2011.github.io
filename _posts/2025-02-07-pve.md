---
layout: post
title: pve
slug: pve
author: ymkNK
date: 2025-02-07 16:12:06 +0800
categories: 
tags: 
img: 1.jpg
---


## 硬盘直通
在 Proxmox VE (PVE) 中，硬盘直通是一种将物理硬盘直接分配给虚拟机使用的技术。
这意味着虚拟机可以完全控制该硬盘，就像它是虚拟机内部的硬盘一样，而不是通过虚拟化层间接访问。
硬盘直通可以提高性能，并允许**虚拟机直接管理硬盘的读写操作**。

> 比如我就一块盘, 一个ssd 4T的盘, 里边有pve系统, 然后pve虚拟出来了windows, centos, 这算硬盘直通吗?
{: .prompt-info }

- 这种情况不算硬盘直通（Passthrough），因为你是在PVE（Proxmox VE）中创建了虚拟机 , 并通过虚拟化技术分配了硬盘空间给这些虚拟机。
- 在这种配置下，硬盘实际上是被PVE管理的，它并没有完全直接交给虚拟机使用。
- 硬盘直通通常是指将物理硬盘或硬盘分区直接分配给虚拟机使用，这样虚拟机能直接控制硬盘，而不会经过宿主机的操作系统管理。
- 硬盘直通可以通过如PCIe passthrough、SCSI passthrough等技术实现，让虚拟机直接访问硬件。
- 在你这种配置中，**SSD 4T盘作为PVE宿主机的存储，然后PVE将存储空间虚拟给了虚拟机** 
- 理论上，虚拟机并不直接控制物理硬盘，而是通过虚拟化层访问虚拟磁盘。**所以这更像是虚拟磁盘分配，而非硬盘直通**
- 如果你想做硬盘直通，你需要在PVE中配置硬盘直通（Disk Passthrough），通常会使用**PCI设备直通技术**将硬盘直接分配给虚拟机，或者通过SATA、SCSI等接口来完成。

> 假如我在pve的物理机上, 插上了一个有数据的2T的移动硬盘, 这算吗
{: .prompt-info }

- 如果你将一个有数据的2T移动硬盘直接插到PVE物理机上，然后通过配置将这个硬盘直接分配给某个虚拟机，这种情况就可以**算作硬盘直通**


> 可以做到, pve中虚拟的windows访问到这个PVE物理机上的移动硬盘吗
{: .prompt-warning}

- 通过直接挂载物理硬盘到虚拟机
```shell
lsblk
```
- 找到你虚拟机的配置文件（通常位于 /etc/pve/qemu-server/ 目录下，文件名是虚拟机的ID，比如101.conf），然后编辑这个配置文件，添加硬盘直通的相关配置
- 通过网络共享（如SMB、NFS等）


> 将物理机上的2T移动硬盘（比如/dev/sdb）挂载到PVE中的Windows虚拟机
{: .prompt-warning}
```shell
lsblk

nano /etc/pve/qemu-server/101.conf
scsi1: /dev/sdb
```
- 在虚拟机中检查是否能识别到该硬盘
- 打开 "磁盘管理" (diskmgmt.msc)
- **挂载物理硬盘到虚拟机后，虚拟机中的操作系统会直接控制这个硬盘。如果虚拟机对硬盘进行了格式化或分区等操作，那么原来的数据可能会丢失。因此，在操作之前，要确保你已经备份好重要数据。**
- 确保虚拟机中的操作系统能够识别和访问硬盘上的文件系统。
  - 如果硬盘格式是NTFS而虚拟机运行的是Windows系统，那是没有问题的。
  - 如果虚拟机使用的是Linux系统，确保它支持读取NTFS或其他文件系统类型（例如：通过ntfs-3g驱动来挂载NTFS分区）。
