---
layout: post
title: kk创建k8s
slug: kk创建k8s
author: ymkNK
date: 2024-05-29 16:59:57 +0800
categories: [云原生,k8s]
tags: [k8s, storageclass, kubekey]
img: 1.jpg
---


## 指定 StorageClass 路径
在 KubeKey 安装过程中指定 StorageClass 路径

创建一个 KubeKey 配置文件

```yaml
apiVersion: kubekey.kubesphere.io/v1alpha2
kind: Cluster
metadata:
  name: sample
spec:
  hosts:
    - {name: master, address: 192.168.0.2, internalAddress: 192.168.0.2, user: root, password: "your_password"}
    - {name: worker, address: 192.168.0.3, internalAddress: 192.168.0.3, user: root, password: "your_password"}
  roleGroups:
    etcd:
      - master
    master:
      - master
    worker:
      - worker
  kubernetes:
    version: v1.23.6
    clusterName: cluster.local
  storage:
    localVolume:
      storageClass:
        isDefaultClass: true
        name: local-path
        hostPaths:
          - path: "/data/k8s-storage" # 指定存储路径
            node: "worker" # 指定节点名称
  network:
    plugin: calico
  registry:
    privateRegistry: ""
```
> 在上面的配置中，通过 hostPaths 字段为 local-path StorageClass 指定了存储路径 /data/k8s-storage，并且该存储路径位于 worker 节点上。

验证 StorageClass
```shell
kubectl get storageclass
```
> 应该能够看到名为 local-path 的 StorageClass，并且它被设置为默认 StorageClass。
{: .prompt-info }



## 自定义 StorageClass
```shell
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: local-storage
provisioner: rancher.io/local-path
parameters:
  type: 'local'
  path: '/data/custom-path'  # 指定你的自定义路径
reclaimPolicy: Delete
volumeBindingMode: WaitForFirstConsumer
```

```shell
kubectl apply -f custom-storageclass.yaml
```
